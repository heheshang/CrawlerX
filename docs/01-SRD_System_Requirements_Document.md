# CrawlerX 系统需求文档 (SRD)
## System Requirements Document

> **版本**: v1.0.0
> **日期**: 2025-12-25
> **项目代号**: CrawlerX
> **文档状态**: 正式发布

---

## 📋 文档信息

| 项目 | 内容 |
|------|------|
| **项目名称** | CrawlerX - 智能视觉驱动的网页数据提取系统 |
| **文档版本** | v1.0.0 |
| **创建日期** | 2025-12-25 |
| **最后更新** | 2025-12-25 |
| **文档作者** | AI System Architect |
| **审核状态** | 待审核 |

---

## 1. 项目概述

### 1.1 项目简介

CrawlerX 是一个基于**计算机视觉 + AI 智能分析**的网页数据提取平台，核心创新在于：

> **用户只需在网页截图上标记目标位置，系统自动识别对应的 DOM 元素或 API 接口，实现精准数据提取。**

### 1.2 项目背景

传统数据提取方案面临的痛点：

| 痛点 | 传统方案 | CrawlerX 方案 |
|------|----------|---------------|
| **技术门槛高** | 需要编写 XPath/CSS 选择器代码 | 可视化截图标记，零代码操作 |
| **动态页面难处理** | 需要分析网络请求，手动找接口 | 自动捕获关联 API，智能字段映射 |
| **维护成本高** | 页面结构变化导致选择器失效 | 自学习优化，智能适配变化 |
| **批量处理困难** | 需要编写脚本实现批量提取 | 支持批量上传，定时增量提取 |

### 1.3 目标用户

| 用户类型 | 典型场景 | 核心价值 |
|----------|----------|----------|
| **电商运营** | 竞品价格监控、库存追踪 | 批量提取商品数据，自动同步 BI |
| **金融分析师** | 财报数据采集、股价监控 | 定时提取财报数据，一致性校验 |
| **数据分析师** | 政务数据采集、行业研究 | 结构化数据提取，多格式输出 |
| **企业用户** | 内部数据自动化采集 | 无需登录态保持，定时任务 |

### 1.4 核心价值主张

```
┌─────────────────────────────────────────────────────────────┐
│  传统方式: 编写代码 → 调试选择器 → 维护脚本 → 处理异常    │
│  CrawlerX:   上传截图 → 标记位置 → 自动提取 → 批量导出    │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 功能需求

### 2.1 功能架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         CrawlerX 功能架构                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   视觉识别   │───▶│   数据关联   │───▶│   数据提取   │        │
│  │   Layer 1   │    │   Layer 2   │    │   Layer 3   │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│         │                   │                   │              │
│         ▼                   ▼                   ▼              │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   坐标映射   │    │  HTML提取   │    │   批量处理   │        │
│  │   标记适配   │    │  API抓包    │    │   定时任务   │        │
│  │   抗干扰     │    │  字段映射   │    │   智能学习   │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                    支撑与扩展层                          │  │
│  │  可视化操作 │ 插件化架构 │ 开放API │ 数据报表 │ 安全合规 │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心功能模块

#### 2.2.1 视觉识别层 (FR-01)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-01-01** | 多维度坐标校准 | 自动适配截图与网页的像素映射，支持不同分辨率、DPI、缩放比例的坐标转换 | P0 |
| **FR-01-02** | 多类型标记适配 | 支持矩形框选、多边形标记、点标记、文字标注 | P0 |
| **FR-01-03** | 抗干扰过滤 | 自动过滤水印、滚动条、浏览器边框、弹窗遮挡 | P1 |
| **FR-01-04** | 模糊标记容错 | 标记偏差≤10px时自动匹配周边最相似的 DOM 元素 | P0 |
| **FR-01-05** | 多帧截图对比 | 支持加载前/加载后/动态刷新多帧截图，识别动态数据变化 | P1 |
| **FR-01-06** | 可视化校准 | 标记后实时预览，支持手动微调坐标映射 | P0 |
| **FR-01-07** | 标记模板复用 | 常用网页标记位置保存为模板，同域名/结构直接复用 | P1 |

#### 2.2.2 数据关联层 (FR-02)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-02-01** | DOM路径智能生成 | 自动生成稳定的 XPath/CSS 选择器，优先基于属性/文本而非位置 | P0 |
| **FR-02-02** | 结构化数据提取 | 标记区域为列表/表格时，自动识别行列结构 | P0 |
| **FR-02-03** | 全维度元素提取 | 提取文本、属性(src/href/data-*)、样式、伪元素内容 | P1 |
| **FR-02-04** | 自动抓包过滤 | 加载URL时自动捕获 API 请求，过滤静态资源 | P0 |
| **FR-02-05** | 接口字段映射 | 自动匹配标记文本与 API 响应字段，支持语义匹配 | P0 |
| **FR-02-06** | 动态参数还原 | 解析请求参数，处理时间戳、token、签名等动态参数 | P1 |
| **FR-02-07** | 多接口关联 | 识别多个关联接口并合并数据 | P1 |
| **FR-02-08** | 混合场景自适应 | 自动判断数据来源(HTML/API)，智能切换提取方式 | P0 |
| **FR-02-09** | 兜底机制 | API失败时从HTML提取，HTML失败时推导API接口 | P1 |

#### 2.2.3 效率层 (FR-03)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-03-01** | 批量上传导入 | 支持多URL、多截图批量导入 | P0 |
| **FR-03-02** | 批量数据提取 | 批量识别标记位置并提取数据 | P0 |
| **FR-03-03** | 定时增量提取 | 配置定时任务，仅增量更新变化数据 | P1 |
| **FR-03-04** | 并发处理控制 | 支持多URL/多标记并行提取，可配置并发数 | P1 |
| **FR-03-05** | 自然语言驱动 | 输入自然语言指令自动识别标记区域 | P2 |
| **FR-03-06** | 自学习优化 | 基于历史记录优化匹配算法 | P2 |
| **FR-03-07** | 跨页面适配 | 同平台其他页面自动适配标记位置 | P2 |

#### 2.2.4 兼容性层 (FR-04)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-04-01** | 多浏览器支持 | 支持 Chrome/Firefox/Safari/Edge 截图与解析 | P1 |
| **FR-04-02** | 多终端适配 | 兼容PC、移动端H5、小程序网页版 | P1 |
| **FR-04-03** | 渲染方式适配 | 支持 SSR/CSR/混合渲染，自动等待页面完全加载 | P0 |
| **FR-04-04** | 鉴权适配 | 支持登录态保持(Cookie/Token)，提取需权限数据 | P0 |
| **FR-04-05** | 多截图格式 | 支持 PNG/JPG/WebP/BMP/TIFF 格式 | P1 |
| **FR-04-06** | 多数据格式 | 支持 JSON/XML/Protobuf API 响应解析 | P0 |
| **FR-04-07** | 多输出格式 | 支持 JSON/Excel/CSV/XML/SQL 输出 | P0 |

#### 2.2.5 可靠性层 (FR-05)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-05-01** | 智能重试机制 | 网络/解析失败时自动重试，可配置次数/间隔 | P0 |
| **FR-05-02** | 结构变化告警 | DOM/API变化时自动告警，相似元素匹配兜底 | P1 |
| **FR-05-03** | 日志溯源 | 记录所有操作，支持日志导出和回溯 | P1 |
| **FR-05-04** | 格式校验 | 提取后自动校验数据格式(价格/手机号等) | P1 |
| **FR-05-05** | 一致性校验 | 对比HTML和API数据，不一致时告警 | P2 |
| **FR-05-06** | 自定义校验规则 | 支持正则/脚本规则配置 | P2 |

#### 2.2.6 扩展与体验层 (FR-06)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-06-01** | 网页预览器 | 内置预览器，直接在页面内标记位置 | P1 |
| **FR-06-02** | 数据可视化报表 | 展示历史趋势、准确率、异常率 | P2 |
| **FR-06-03** | 插件化架构 | 支持自定义解析规则、告警方式、输出格式 | P2 |
| **FR-06-04** | 开放API | 提供 RESTful API，支持第三方集成 | P1 |
| **FR-06-05** | 生态集成 | 支持 Tableau/Power BI/MySQL/Redis/Airflow 集成 | P2 |

#### 2.2.7 合规与安全层 (FR-07)

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| **FR-07-01** | Robots遵守 | 自动检测 robots.txt，限制爬取频率 | P0 |
| **FR-07-02** | 频率限制 | 可配置请求间隔，避免IP封禁 | P0 |
| **FR-07-03** | 隐私脱敏 | 自动识别并脱敏敏感信息 | P1 |
| **FR-07-04** | 加密存储 | 截图、URL、数据加密存储 | P1 |
| **FR-07-05** | 权限控制 | 分角色权限管理 | P1 |
| **FR-07-06** | 数据过期清理 | 支持数据过期自动清理 | P2 |

### 2.3 功能优先级矩阵

```
                    ┌──────────────────────────────────────┐
                    │         业务价值                      │
                    │                                      │
        High        │  FR-01  FR-02  FR-03                 │
        ▲           │  ┌────┐┌────┐┌────┐                  │
        │           │  │坐标││DOM ││批量│  FR-07         │
   优    │           │  │映射││提取││处理│  ┌────┐        │
   先    │           │  └────┘└────┘└────┘  │合规│        │
   级    │           │                      └────┘        │
        │           │  FR-04  FR-05  FR-06                │
        │           │  ┌────┐┌────┐┌────┐                  │
        Low         │  │兼容││可靠││扩展│                  │
                    │  └────┘└────┘└────┘                  │
                    └──────────────────────────────────────┘
                        ───────────────────────────────▶ Low
                              实现复杂度

P0 = 必须实现 (核心功能)
P1 = 重要实现 (增强功能)
P2 = 可选实现 (锦上添花)
```

---

## 3. 非功能需求

### 3.1 性能需求 (NFR-01)

| 需求ID | 需求描述 | 指标值 | 测量方法 |
|--------|----------|--------|----------|
| **NFR-01-01** | 单次提取响应时间 | ≤ 5秒 | 从上传截图到返回数据 |
| **NFR-01-02** | 批量处理吞吐量 | ≥ 100次/分钟 | 并发提取能力 |
| **NFR-01-03** | 网页加载超时 | ≤ 10秒 | 单个页面加载超时 |
| **NFR-01-04** | 并发用户数 | ≥ 1000 | 同时在线用户 |
| **NFR-01-05** | API响应时间 | ≤ 500ms | P95 响应时间 |

### 3.2 可用性需求 (NFR-02)

| 需求ID | 需求描述 | 指标值 | 测量方法 |
|--------|----------|--------|----------|
| **NFR-02-01** | 系统可用性 | ≥ 99.5% | 月度统计 |
| **NFR-02-02** | 故障恢复时间 | ≤ 1小时 | MTTR |
| **NFR-02-03** | 数据备份频率 | 每日 | 自动备份 |
| **NFR-02-04** | 灾难恢复 | ≤ 4小时 | RTO |

### 3.3 可扩展性需求 (NFR-03)

| 需求ID | 需求描述 | 指标值 | 测量方法 |
|--------|----------|--------|----------|
| **NFR-03-01** | 水平扩展能力 | 支持 | 无状态服务 |
| **NFR-03-02** | 存储扩展能力 | 支持 | 分布式存储 |
| **NFR-03-03** | 插件扩展能力 | 支持 | 插件化架构 |

### 3.4 安全性需求 (NFR-04)

| 需求ID | 需求描述 | 指标值 | 测量方法 |
|--------|----------|--------|----------|
| **NFR-04-01** | 数据传输加密 | TLS 1.3 | HTTPS |
| **NFR-04-02** | 数据存储加密 | AES-256 | 字段级加密 |
| **NFR-04-03** | 身份认证 | JWT + OAuth2 | 标准 |
| **NFR-04-04** | 访问控制 | RBAC | 角色权限 |
| **NFR-04-05** | 审计日志 | 完整记录 | 操作追溯 |

### 3.5 可维护性需求 (NFR-05)

| 需求ID | 需求描述 | 指标值 | 测量方法 |
|--------|----------|--------|----------|
| **NFR-05-01** | 代码覆盖率 | ≥ 80% | 单元测试 |
| **NFR-05-02** | API文档完整性 | 100% | Swagger |
| **NFR-05-03** | 日志完整度 | 100% | 全链路追踪 |
| **NFR-05-04** | 监控告警 | 覆盖 | Prometheus |

### 3.6 兼容性需求 (NFR-06)

| 需求ID | 需求描述 | 支持范围 |
|--------|----------|----------|
| **NFR-06-01** | 浏览器支持 | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| **NFR-06-02** | 操作系统支持 | Windows 10+, macOS 11+, Linux (主流发行版) |
| **NFR-06-03** | 移动端支持 | iOS 14+, Android 10+ |
| **NFR-06-04** | 截图格式支持 | PNG, JPG, WebP, BMP, TIFF |

---

## 4. 数据需求

### 4.1 输入数据

| 数据类型 | 格式要求 | 示例 |
|----------|----------|------|
| **URL** | HTTP/HTTPS 协议 | `https://example.com/product/123` |
| **截图** | PNG/JPG/WebP, ≤10MB | 上传图片文件 |
| **标记坐标** | JSON 格式 | `{"x": 100, "y": 200, "width": 50, "height": 30}` |
| **Cookie/Token** | JSON/文本 | `{"session": "xxx"}` |

### 4.2 输出数据

| 数据类型 | 格式选项 | 示例 |
|----------|----------|------|
| **提取结果** | JSON/Excel/CSV/XML/SQL | 结构化数据 |
| **日志记录** | JSON | 操作日志 |
| **统计报表** | JSON/图表 | 数据看板 |

### 4.3 数据质量

| 质量维度 | 要求 | 验证方法 |
|----------|------|----------|
| **准确性** | ≥ 95% | 与人工对比验证 |
| **完整性** | 100% | 空值检查 |
| **一致性** | 100% | 多源对比 |
| **时效性** | ≤ 5秒 | 响应时间 |

---

## 5. 接口需求

### 5.1 用户接口

| 接口类型 | 需求描述 |
|----------|----------|
| **Web界面** | 响应式设计，支持PC/移动端 |
| **API接口** | RESTful API，提供完整功能 |
| **CLI工具** | 命令行工具，支持脚本调用 |

### 5.2 外部接口

| 接口类型 | 需求描述 |
|----------|----------|
| **浏览器驱动** | 支持 Selenium/Puppeteer |
| **存储接口** | 支持 S3/OSS/本地存储 |
| **数据库接口** | 支持 MySQL/PostgreSQL/MongoDB |
| **消息队列** | 支持 RabbitMQ/Kafka/Redis |
| **第三方集成** | Tableau, Power BI, Airflow 等 |

---

## 6. 约束条件

### 6.1 技术约束

| 约束项 | 描述 |
|--------|------|
| **编程语言** | 后端: Python/Node.js, 前端: React/Vue |
| **浏览器** | 基于 Chrome/Chromium |
| **部署环境** | 支持 Docker/Kubernetes |
| **数据库** | PostgreSQL + Redis |

### 6.2 业务约束

| 约束项 | 描述 |
|--------|------|
| **合规性** | 遵守 robots.txt 和相关法律法规 |
| **频率限制** | 避免对目标网站造成压力 |
| **数据隐私** | 敏感数据必须脱敏处理 |

### 6.3 法律约束

| 约束项 | 描述 |
|--------|------|
| **数据采集** | 遵守《网络安全法》《数据安全法》 |
| **用户数据** | 遵守《个人信息保护法》 |
| **知识产权** | 尊重网站版权和 Terms of Service |

---

## 7. 验收标准

### 7.1 功能验收

| 验收项 | 标准 |
|--------|------|
| **核心功能** | 100% 完成 P0 功能 |
| **增强功能** | ≥ 80% 完成 P1 功能 |
| **可选功能** | ≥ 50% 完成 P2 功能 |

### 7.2 性能验收

| 验收项 | 标准 |
|--------|------|
| **响应时间** | 95% 请求 ≤ 5秒 |
| **并发能力** | 支持 1000 并发用户 |
| **可用性** | ≥ 99.5% |

### 7.3 质量验收

| 验收项 | 标准 |
|--------|------|
| **Bug数量** | P0/P1: 0, P2: ≤ 5, P3: ≤ 20 |
| **代码覆盖率** | ≥ 80% |
| **文档完整性** | 100% |

---

## 8. 风险与假设

### 8.1 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| **复杂动态页面** | 提取失败率上升 | 增强 AI 模型，提供兜底方案 |
| **网站反爬** | 频繁被反爬限制 | 智能频率控制，代理池 |
| **大文件处理** | 性能下降 | 流式处理，分片上传 |

### 8.2 业务风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| **法律合规** | 违规风险 | 法律审查，合规检测 |
| **用户滥用** | 被投诉/封禁 | 用户协议，使用监控 |
| **数据泄露** | 安全事故 | 加密存储，权限控制 |

### 8.3 假设条件

| 假设项 | 说明 |
|--------|------|
| **网络环境** | 用户可访问目标网站 |
| **截图质量** | 用户提供的截图清晰可辨 |
| **网站稳定性** | 目标网站结构相对稳定 |

---

## 9. 附录

### 9.1 术语表

| 术语 | 定义 |
|------|------|
| **DOM** | Document Object Model，文档对象模型 |
| **XPath** | XML Path Language，XML路径语言 |
| **API** | Application Programming Interface，应用程序接口 |
| **SSR** | Server-Side Rendering，服务端渲染 |
| **CSR** | Client-Side Rendering，客户端渲染 |
| **RBAC** | Role-Based Access Control，基于角色的访问控制 |

### 9.2 参考文档

| 文档 | 链接 |
|------|------|
| 系统架构设计文档 | `./02-SAD_System_Architecture_Design.md` |
| 数据库设计文档 | `./03-DDD_Database_Design_Document.md` |
| 任务规划文档 | `./04-TPD_Task_Planning_Document.md` |

---

**文档变更记录**

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0.0 | 2025-12-25 | 初始版本 | AI System Architect |

---

*本文档为 CrawlerX 项目正式需求规格说明，所有功能需求、非功能需求、数据需求、接口需求均需在系统实现中满足。*
